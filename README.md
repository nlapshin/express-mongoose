# Создание веб-сервера на NodeJS.

Задача: нам нужно создать веб-сервер "с нуля".
Что должно входить в хороший веб-сервер и какие вопросы мы должны обсудить и решить с командой?

- Определиться с протокол обмена и способом взаимодействия с внешними клиентами.
RESTfull подход в написание.
GraphQL подход.
SOAP.
RPC подход.
- Определиться с технологиями.
Мы выбираем фреймворк(NestJS, Express, Fastify и т.д.).
Выбираем БД(postgres + mongodb + redis).
Монолит или микросервис. Если микросервис: event bus.
- Логгер.
Winston, pino, bunyan и т.д.
Почему недостаточно console.log(error, warn)?
Он пишет в stdout(в консоль), а если хотим писать в файл или бд?
Или сторонний сервис типа sentry?
У нас есть log.error(msg) -> и нас нотифицируют об этом.
ELK - elastic search(база данных для логов), 
logstash(система которая забирает логи, harvester), 
kibana(инструмент для визуализации).

Нам нужен сериализованный формат. Подходит хорошо JSON.
Нам важно чтобы логгирование не влияло на сам сервер.
Логгер мультипоточный. Pino, bunyan умеют в multistream.

- Тестирование.
Выб
- Документация(swagger).
Позаботится об этом и самоподдерживаемой. JSON schema.
- Валидация и сериализация.
Joi или JSON schema.
Валидация - это проверка входных данных.
Сериализация - это проверка выходных данных.
- Составить схему. Data transfer object(DTO).
- Безопастность.
Разные уязвимости, решают из коробки.
- Мониторинг.
Prometheus + graphana.

Пишем POST /login { username, password }. Послал неправильный пароль.
Это какой статус? 400 статус. Bad Request - это очень общий статус.
Я шлю 400 статус { statusExt: 400001, errorMsg: 'Incorrect username or password' }
Шлют 200 статус { error: true }

Базы данных или кэш - это разве не сохранение состояния?
Распределенное хранилище.

Можно потерять.

Исключение хранить состояние на сервере?

- аналитическую систему highload, от 1М записей в сутки. Данные приходят очень быстро.
Хорошо записывать данные патчками(batch-ами) нежели по одному. Буффер данных.
Самое главное их не потерять.

Мы используем статусы и методы HTTP.

/order или /orders. Почему у множественного числа есть недостатки?

mice - mouse.
deer - deer.
person - people.
